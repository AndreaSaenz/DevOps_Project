pipeline {
     agent any
    parameters {
        string(name: 'branch', defaultValue: '', description: 'Descripci칩n del par치metro 1')
        string(name: 'buildNumber', defaultValue: '', description: 'Descripci칩n del par치metro 2')
    }
    stages {
        stage('Create Docker Image') {
            steps {
                sh '#docker image ls -a'
                sh '#docker build . -t devops_project-${params.branch}:1.0.0-${params.buildNumber}'
                sh '#docker image ls -a'
                sh '#docker container ls -a'
            }
        }
        stage('Stop containers') {
            steps {
                sh '#running=$(docker ps --filter name=devops_project-${params.branch}* --filter status=running -aq)'
                sh '#if [-z $running]then #Print error message echo "No hay contenedores ejecutandose" else #Se apagan los contenedores con el mismo nombre docker ps --filter name=devops_project-${params.branch}* --filter status=running -aq | xargs docker stop fi'
                sh '#docker run -d -p 8080:8080 --name sicei-container sicei-${GIT_BRANCH}:1.0.0-${params.buildNumber}'
                sh '#docker container ls -a'
                sh '#docker run -p 127.0.0.1:30${params.buildNumber}:3000 --name devops_project-${params.branch}-${params.buildNumber} -d devops_project-${params.branch}:1.0.0-${params.buildNumber}'
                sh '#docker container ls -a'
                sh '#docker container start devops_project-${params.branch}-${params.buildNumber}'
                sh '#docker container ls'
            }
        }
    }
}